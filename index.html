<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Client</title>
    <style>
        :root { --yt-black: #0f0f0f; --yt-text: #ffffff; --yt-grey: #aaaaaa; --yt-border: #3f3f3f; --yt-red: #ff0000; }
        body { background-color: var(--yt-black); color: var(--yt-text); font-family: "Roboto", sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        nav { height: 56px; display: flex; align-items: center; padding: 0 16px; background: var(--yt-black); border-bottom: 1px solid var(--yt-border); }
        .wrapper { display: flex; flex: 1; overflow: hidden; }
        aside { width: 240px; padding: 12px; border-right: 1px solid #222; }
        main { flex: 1; padding: 24px; overflow-y: auto; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { cursor: pointer; }
        .thumb { width: 100%; aspect-ratio: 16/9; background: #222; border-radius: 12px; object-fit: cover; }
        .title { font-size: 16px; margin: 10px 0 5px 0; font-weight: 500; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .meta { color: var(--yt-grey); font-size: 14px; }
        .status { padding: 20px; color: var(--yt-grey); font-family: monospace; font-size: 12px; }
        button { background: #333; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #444; }
    </style>
</head>
<body>

    <nav>
        <div style="font-weight: bold; font-size: 20px;"><span style="color:red">â–¶</span> VideoClient</div>
    </nav>

    <div class="wrapper">
        <aside>
            <button onclick="fetchVideos()" style="width:100%">Refresh Feed</button>
            <div id="log" class="status">Initializing...</div>
        </aside>

        <main>
            <div class="video-grid" id="grid"></div>
        </main>
    </div>

    <script>
        const log = document.getElementById('log');
        const grid = document.getElementById('grid');

        // Mixed sources: Piped and Invidious
        const SOURCES = [
            { name: "Piped (Kavin)", url: "https://pipedapi.kavin.rocks/trending?region=US", type: "piped" },
            { name: "Invidious (LND)", url: "https://invidious.lunar.icu/api/v1/trending", type: "invidious" },
            { name: "Invidious (Privacy)", url: "https://inv.tux.pizza/api/v1/trending", type: "invidious" },
            { name: "Piped (Rivo)", url: "https://pipedapi.rivo.gg/trending?region=US", type: "piped" }
        ];

        async function fetchVideos() {
            grid.innerHTML = "";
            log.innerHTML = "Starting source scan...";

            for (let src of SOURCES) {
                try {
                    log.innerHTML += `<br>Trying ${src.name}...`;
                    
                    // Using a different proxy for better compatibility
                    const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(src.url)}`);
                    const wrapper = await response.json();
                    const data = JSON.parse(wrapper.contents);

                    if (data && (data.length > 0 || data.items)) {
                        log.innerHTML += `<br><span style="color:lightgreen">Success!</span>`;
                        render(data, src.type);
                        return;
                    }
                } catch (e) {
                    log.innerHTML += `<br><span style="color:red">Failed.</span>`;
                }
            }
            log.innerHTML += `<br><strong>All sources failed. YouTube is blocking proxies.</strong>`;
        }

        function render(data, type) {
            const videos = type === "invidious" ? data : data; // Both return arrays
            
            videos.forEach(v => {
                // Handle different naming conventions between APIs
                const title = v.title;
                const author = v.author || v.uploaderName;
                const thumb = v.videoThumbnails ? v.videoThumbnails[0].url : v.thumbnail;
                const videoId = v.videoId || v.url.split("=")[1] || v.url.split("/").pop();

                const card = document.createElement('div');
                card.className = "card";
                card.innerHTML = `
                    <img class="thumb" src="${thumb}">
                    <div class="title">${title}</div>
                    <div class="meta">${author}</div>
                `;
                card.onclick = () => window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
                grid.appendChild(card);
            });
        }

        fetchVideos();
    </script>
</body>
</html>
