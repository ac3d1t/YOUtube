<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Client</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { background: #1a1a1a; border-radius: 8px; overflow: hidden; cursor: pointer; }
        .card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .info { padding: 10px; }
        #error-display { color: #ff4444; background: #220000; padding: 10px; margin-bottom: 20px; display: none; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>Home</h1>
    <div id="error-display"></div>
    <div id="main-grid" class="grid">Loading videos...</div>

    <script>
        const displayError = (msg) => {
            const el = document.getElementById('error-display');
            el.style.display = 'block';
            el.innerHTML = `<strong>Error:</strong> ${msg}`;
        };

        async function init() {
            const grid = document.getElementById('main-grid');
            // Testing the most reliable 2026 instance
            const api_url = "https://inv.tux.pizza/api/v1/trending";

            try {
                const response = await fetch(api_url);
                if (!response.ok) throw new Error("Server rejected the request.");
                
                const data = await response.json();
                
                if (!data || data.length === 0) {
                    grid.innerHTML = "No videos found.";
                    return;
                }

                grid.innerHTML = "";
                data.forEach(v => {
                    const card = document.createElement('div');
                    card.className = "card";
                    card.innerHTML = `
                        <img src="${v.videoThumbnails[0].url}">
                        <d<script>
    const grid = document.getElementById('main-grid');
    const errorEl = document.getElementById('error-display');

    // These are the most stable Invidious instances for 2026
    const INSTANCES = [
        "https://inv.tux.pizza",
        "https://invidious.lunar.icu",
        "https://iv.melmac.space",
        "https://invidious.projectsegfau.lt"
    ];

    async function init() {
        grid.innerHTML = "Searching for a live connection...";
        
        for (let base of INSTANCES) {
            try {
                // Using 'allorigins' to wrap the request and bypass CORS blocks
                const target = `${base}/api/v1/trending?region=US`;
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(target)}`;
                
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error("Next...");

                const wrapper = await response.json();
                const data = JSON.parse(wrapper.contents);
                
                if (data && data.length > 0) {
                    render(data);
                    return; // Stop once we find a working one!
                }
            } catch (err) {
                console.log(`Skipping ${base} - busy or blocked.`);
            }
        }
        
        grid.innerHTML = "All instances are busy. Try clicking 'Refresh' in a minute.";
    }

    function render(videos) {
        grid.innerHTML = "";
        videos.forEach(v => {
            const card = document.createElement('div');
            card.className = "card";
            const thumb = v.videoThumbnails ? v.videoThumbnails[0].url : "";
            
            card.innerHTML = `
                <img src="${thumb}" onerror="this.src='https://via.placeholder.com/320x180?text=No+Thumb'">
                <div class="info">
                    <div style="font-weight:bold; font-size: 14px; margin-bottom: 4px;">${v.title}</div>
                    <div style="color:#aaa; font-size:12px">${v.author}</div>
                </div>
            `;
            card.onclick = () => window.open(`https://www.youtube.com/watch?v=${v.videoId}`, '_blank');
            grid.appendChild(card);
        });
    }

    init();
</script>
</body>
</html>
