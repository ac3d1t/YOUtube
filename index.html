<script>
    const log = document.getElementById('log');
    const grid = document.getElementById('grid');

    // We are going to use a different set of reliable instances
    const SOURCES = [
        "https://invidious.flokinet.to/api/v1/trending",
        "https://iv.melmac.space/api/v1/trending",
        "https://invidious.sethforprivacy.com/api/v1/trending"
    ];

    async function fetchVideos() {
        grid.innerHTML = "";
        log.innerHTML = "Performing deep scan...";

        for (let url of SOURCES) {
            try {
                log.innerHTML += `<br>Scanning ${url.split('/')[2]}...`;
                
                // Using a 'Cloudflare Worker' style proxy which is much harder for YT to block
                const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;
                
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error();

                const data = await response.json();
                
                if (data && data.length > 0) {
                    log.innerHTML += `<br><span style="color:lightgreen">Connection Established!</span>`;
                    render(data);
                    return;
                }
            } catch (e) {
                log.innerHTML += `<br><span style="color:red">Instance Refused.</span>`;
            }
        }
        log.innerHTML += `<br><strong>Critical Failure:</strong> All endpoints are currently rate-limited by YouTube.`;
    }

    function render(videos) {
        videos.forEach(v => {
            const card = document.createElement('div');
            card.className = "card";
            // Invidious API uses 'videoThumbnails' array
            const thumb = v.videoThumbnails ? v.videoThumbnails[0].url : v.thumbnail;
            
            card.innerHTML = `
                <img class="thumb" src="${thumb}" onerror="this.src='https://via.placeholder.com/320x180?text=No+Thumbnail'">
                <div class="title">${v.title}</div>
                <div class="meta">${v.author} â€¢ ${v.publishedText || 'Recent'}</div>
            `;
            card.onclick = () => window.open(`https://www.youtube.com/watch?v=${v.videoId}`, '_blank');
            grid.appendChild(card);
        });
    }

    fetchVideos();
</script>
